@model Vidly2.Models.CustomerList
@{
	int i = 1;
}

<h1>Customers</h1>
<a href="/customers/new" class="btn btn-primary mb-2">New Customer</a>

@if (Model.Customers.Count == 0)
{
	<p>No customers yet.</p>
}
else
{
	<table id="customers" class="display">
		<thead>
			<tr>
				<th>Customers</th>
				<th>Membership Type</th>
				<th>Delete</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var customer in Model.Customers)
			{
				<tr>
					<td><a href="/customers/edit/@i">@customer.Name</a></td>
					<td>@customer.MembershipType.Name</td>
					<td><button data-customer-id="@customer.Id" class="btn btn-link js-delete">Delete</button></td>
				</tr>
				i++;
			}
		</tbody>
	</table>
}

@section scripts {
	<script>
		$(document).ready(function() {
			$("#customers").DataTable();

			$("#customers").on("click",".js-delete", function () {
				var button = $(this);

				bootbox.confirm("Are you sure you want to delete this customer?", function(result) {
					if (result)
					{
						$.ajax({
							url: "/api/customers/" + button.attr("data-customer-id"),
							method: "DELETE",
							success: function ()
							{
								button.parents("tr").remove();
							}
						});
					}
				});
			});
		});
	</script>
}